<!--Refactorizado el 27 de julio  -->
<script id="sample_ng_header" type="text/ng-template">
    <!-- columnas combinadas -->
    <tr ng-if="config.combinada">
        <th class="short" ng-if="config.tieneSelectores" rowspan="2"></th>
        <th ng-repeat="col in  columnas" rowspan="1" colspan="{{ col.combinada? config.combinada: 1 }}"
            ng-if="!col.combinable">
            <span ng-if="col.combinada">{{ col.combinada }}</span>
        </th>
    </tr>
    <!-- Columnas normales  -->
    <tr>
        <!-- check padre -->
        <th ng-if="config.tieneSelectores" ng-class="{'short': !config.nombreSelector, 'middle':config.nombreSelector, 'columna-fija': config.fijas && config.fijas > 0}" >
            <div class="checkbox-wrapper" ng-show="config.multiSeleccionable">
                <input type="checkbox" ng-model="config.checks.checked" ng-disabled="$data.length===0"
                       ng-change="cambioCheckPadre()" id="{{$id}}checkbox-interno-header"/>
                <label for="{{$id}}checkbox-interno-header"><span
                        class="ui-chkbox-icon ui-icon-black ui-icon-check"></span></label>
            </div>
            <label class="nombre-selector" ng-if="config.nombreSelector"> {{ config.nombreSelector }} </label>
        </th>
        <!-- columnas de acuerdo a la configuracion -->
        <th ng-repeat="column in columnas" ng-show="true"
            class="text-center sortable" ng-class="{
            'no-filtro': !column.filtro ,
            'sort-asc': tabDatos.isSortBy($index, 'desc'),
            'sort-desc': tabDatos.isSortBy($index, 'asc'),
            'short': column.short,
            'large': column.large,
            'order': column.orden,
            'columna-fija': config.fijas && (config.fijas > $index - (config.tieneSelectores ? 1: 0)),
            'columna-no-fija': config.fijas && !(config.fijas > $index - (config.tieneSelectores ? 1: 0))
          }"
            data-fijas="col-{{ config.fijas ? config.fijas: 0 }}"
            ng-click="column.orden && ordenar($index)"
            ng-init="orden[$index]=undefined">
            <!-- modificador -->
            <div class="td-text-columna" ng-if="column.modificadorCol" ng-bind-html="column.modificadorCol(column.nombre) | sanitize"></div>
            <!-- nombre de la columna -->
            <div class="td-text-columna" ng-if="!column.modificadorCol">{{column.nombre}}</div>
            <span ng-if="column.orden" ng-bind="$column.title(this)"
                  ng-class="{'sort-indicator': params.settings().sortingIndicator=='span', 'ui-icon-carat-2-n-s': (orden[$index]==undefined), 'ui-icon-triangle-1-n': orden[$index]===true, 'ui-icon-triangle-1-s': orden[$index]===false}"
                  class="ng-binding ui-icon">
                  </span>
            <form name="form" style="margin-top:0px" ng-class="{'no-visible': !column.filtro}">
                <div ng-if="column.filtro" >
                    <div class="contenedor-check" >
                        <div ng-init="params.filter()[$index]=''">
                            <input type="text" ng-disabled="$filterRow.disabled"
                                    ng-model="params.filter()[$index]" class="input-filter form-control"
                                    ng-if="!column.mask"
                                    ng-click="detenerPropagation($event); cerrarMenus()"/>
                            <input type="text" ng-disabled="$filterRow.disabled"
                                    ng-model="params.filter()[$index]" class="input-filter form-control"
                                    ng-if="column.mask"
                                    restrict="reject" data-mask="{{ column.mask }}"
                                    ng-click="detenerPropagation($event); cerrarMenus()"/>
                         </div>
                    </div>
                </div>
            </form>
        </th>
    </tr>
</script>
<!---Body de la tabla  -->
<div class="table-responsive">
    <table class="table table-datos"
           ng-class="{'tieneSelectores': config.tieneSelectores, 'table-hover':!noSeleccionable, 'td-hay-datos': modeloTabla.datos().length > 0 }"
           template-header="sample_ng_header" ng-table="tabDatos">
        <!-- iterando datos -->
        <tr ng-repeat="fila in $data" class="data-row color-{{ cargarClase(fila) }}" 
            ng-init="fila.$$id_tr='id-row-tabla-datos-'+$index" ng-class="{sombreado: fila.activo, 'sin-mouse':noSeleccionable || config.bloqueada}"
            btn-derecho
            menu="modeloTabla.menuDerecho()" elemento="fila" datos="modeloTabla.datos()"
            ng-if="$data.length > 0">

            <td ng-if="config.tieneSelectores" ng-click="!noSeleccionable && !isBloqueada(fila) && cambiar_linea(fila, $event)" ng-class="{ 'fila-fija': (config.fijas && config.fijas > 0) }">
                <div class="checkbox-wrapper" ng-click="detenerPropagation($event)" >
                    <input type="checkbox" ng-model="fila.activo" ng-change="cambioCheckFila(fila)"
                           id="{{$id}}chkbox-data-{{ $index }}"/>
                    <label for="{{$id}}chkbox-data-{{ $index }}" ng-click="detenerPropagation($event);cerrarMenus()"><span
                            class="ui-chkbox-icon ui-icon-black ui-icon-check"></span></label>
                </div>
            </td>

            <!-- Para que es esto? Si marca error descomente
            <td ng-if="config.buscadora" ng-repeat="columna in columnas" sortable="columna.orden"
                filter="columna.filtro" ng-click="!noSeleccionable && cambiar_linea(row, $event)"
                ng-class="{'sin-mouse':noSeleccionable}">
                <div ng-bind="columna.modificador ? columna.modificador(columna.real ? row[columna.real]: row[columna.clave],row): (columna.real ? row[columna.real]: row[columna.clave])">

                </div>
            </td>
            -->
            <td ng-repeat="columna in columnas"  class="data-row color-{{ columna.cargarClase(fila) }}"
                ng-click="!noSeleccionable && !isBloqueada(fila) && cambiar_linea(fila, $event)" ng-class="{'sin-mouse':noSeleccionable || config.bloqueada, 'fila-fija': config.fijas && (config.fijas > $index - (config.tieneSelectores ? 1: 0)), 
                                                    'fila-no-fija': config.fijas && !(config.fijas > $index - (config.tieneSelectores ? 1: 0))}"
                data-fijas="col-{{ config.fijas ? config.fijas: 0 }}"
                >
                <!-- Pintar columnas de acuerdo a la configuracion -->
                <!--Progresivo -->
                <div class="td-text-fila" ng-if="columna.progresivo">
                    {{ (counts.selected * (paginaActual - 1)) + $data.indexOf(fila) + 1 }}
                </div>
                <!-- columna html  -->
                <div class="td-text-fila" ng-if="columna.html &&  modeloTabla.datos()[fila.$$identificador]" ng-init="row = modeloTabla.datos()[fila.$$identificador]">
                    <div ng-if="!columna.compile"  ng-bind-html="columna.html(row) | sanitize" ng-click="columna.actionHtml(row)"></div>
                    <div ng-if="columna.compile" bind-html-compile="columna.html(row)" bind-html-scope="columna.scope(row)"
                         ng-click="columna.actionHtml(row)"></div>
                </div>
                <!-- Con modificador o sin nada  -->
                <div class="td-text-fila" ng-if="!columna.action&&!columna.html&&!columna.botonera&&!columna.progresivo">
                    {{ columna.modificador ? columna.modificador(columna.real ? fila[columna.real]: fila[columna.clave],
                    fila): (columna.real ? fila[columna.real]: fila[columna.clave]) }}
                </div>
                <!--columna con action -->
                <div class="td-text-fila" ng-if="columna.action" ng-click="ejecutarAccionDato(fila, columna.action, $event); cerrarMenus()">
                    <a href=""
                       class="action color-link-{{ columna.cambiarColorLink ? columna.cambiarColorLink(fila):'' }}">
                        {{ columna.modificador ? columna.modificador(columna.real ? fila[columna.real]: fila[columna.clave],
                            fila): (columna.real ? fila[columna.real]: fila[columna.clave]) }}
                    </a>
                </div>
                <!-- Columna tiene botonera, no se si alguien la use -->
                <div class="td-text-fila" ng-if="columna.botonera">
                    <button type="button" ng-repeat="boton in columna.botonera"  ng-show="!boton.activo || (boton.activo && boton.activo(fila))" ng-click='boton.action(fila); cerrarMenus()' title="{{ boton.title | translate }}"><span
                            class='ui-icon {{ boton.icono }}'></span>
                    </button>
                </div>
            </td>
        </tr>
        <!-- Sin datos que mostrar -->
        <tr ng-if="$data.length == 0">
            <td colspan="{{ (config.tieneSelectores ? columnas.length+1:columnas.length) + config.fijas }}">{{ config.mensaje }}</td>
        </tr>
    </table>
</div>
<!--paginacion -->
<div class="table-paginacion" ng-show="modeloTabla.datos().length > modeloTabla.agrupaciones()[0]">
    <div class="table-comandos" ng-init="paginaActual=1">

        <button type="button" id="button-inicio"
                ng-click="cambiarPagina(1)" ng-disabled="paginaActual <= 1"><span
                class="ui-icon ui-icon-seek-first"></span></button>
        <button type="button"  id="button-anterior"
                ng-click="cambiarPagina(paginaActual - 1)" ng-disabled="paginaActual <= 1"><span
                class="ui-icon ui-icon-seek-prev"></span></button>
        <button type="button" ng-repeat="boton in buttons.paginas" class="bots" 
                id="button-{{ boton }}"
                ng-click="cambiarPagina(boton.number)" ng-class="{ active:(boton.number==paginaActual) }">{{
            boton.number }}
        </button>
        <button type="button"  id="button-siguiente"
                ng-click="cambiarPagina(paginaActual + 1)" ng-disabled="paginaActual >= totalPaginas">
            <span class="ui-icon ui-icon-seek-next"></span></button>
        <button type="button"  id="button-fin"
                ng-click="cambiarPagina(totalPaginas)"
                ng-disabled="paginaActual >= totalPaginas"><span class="ui-icon ui-icon-seek-end"></span></button>
        <select class="table-numero-paginas" ng-init="counts.selected = counts.data[0]" ng-model="counts.selected"
                ng-change="cambiarFilasPorPagina()" ng-options="c as c for c in counts.data">
        </select>
    </div>
</div>
